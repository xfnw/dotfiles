#!/bin/sh

set -e

WORKDIR="$(mktemp -d)"

cat >"$WORKDIR/math.tex" <<EOF
\documentclass[12pt]{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\thispagestyle{empty}
\begin{document}
\hoffset=-0.9in
\voffset=-0.9in
\setbox0\hbox{
EOF

echo "${1:-usage: $0 expression [output]}" >>"$WORKDIR/math.tex"

cat >>"$WORKDIR/math.tex" <<EOF
}
\pdfpageheight=\dimexpr\ht0+\dp0+0.2in\relax
\pdfpagewidth=\dimexpr\wd0+0.2in\relax
\shipout\box0
\stop
EOF

pdflatex --output-directory "$WORKDIR" "$WORKDIR/math.tex" 1>&2
pdf2svg "$WORKDIR/math.pdf" "${2:-/dev/stdout}"

rm -r -- "$WORKDIR"

